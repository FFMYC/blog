<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·»åŠ æ–‡ç«  - F_F_M_YC</title>
    <link rel="icon" href="../icon.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
        body { background-color: #f5f5f5; color: #333; line-height: 1.6; padding: 20px; position: relative; }
        .back-btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 20px; color: #38a038; border: 2px solid #ff0000; background: white; border-radius: 5px; cursor: pointer; transition: all 0.3s; text-decoration: none; margin-bottom: 20px; }
        .back-btn:hover { background: #0000008a; color: white; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); padding: 40px; }
        h1 { color: #2c3e50; margin-bottom: 30px; text-align: center; }
        .form-group { margin-bottom: 25px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: #2c3e50; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 15px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 16px; transition: border-color 0.3s; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: #3498db; }
        .form-textarea { min-height: 200px; font-family: 'Consolas', monospace; resize: vertical; }
        .form-hint { font-size: 13px; color: #7f8c8d; margin-top: 5px; }
        .form-actions { display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; }
        .auth-section { padding: 40px 0; }
        .auth-card { background: #f8f9fa; padding: 30px; border-radius: 8px; border: 1px solid #e1e4e8; }
        .auth-card h2 { color: #2c3e50; margin-bottom: 25px; text-align: center; }
        .btn { padding: 12px 30px; border-radius: 4px; font-size: 16px; cursor: pointer; border: none; transition: background-color 0.3s; }
        .btn-primary { background-color: #3498db; color: white; }
        .btn-primary:hover { background-color: #2980b9; }
        .btn-secondary { background-color: #f5f5f5; color: #333; }
        .btn-secondary:hover { background-color: #e8e8e8; }
        .checkbox-group { display: flex; align-items: center; gap: 10px; }
        .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .checkbox-group label { cursor: pointer; }
        .tag-type-indicator { display: inline-block; padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 500; }
        .tag-type-visible { background: #3498db; color: white; }
        .tag-type-hidden { background: #e74c3c; color: white; }
        .file-info { margin-top: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 4px; border-left: 4px solid #3498db; display: none; }
        .draft-selector { margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 4px; border-left: 4px solid #ffc107; display: none; }
        .draft-selector h3 { margin-bottom: 10px; color: #856404; }
        .draft-item { padding: 10px; margin: 5px 0; background: white; border-radius: 4px; cursor: pointer; transition: background 0.3s; }
        .draft-item:hover { background: #f8f9fa; }
        .draft-item.selected { background: #d4edda; border-left: 3px solid #28a745; }
        .file-info h3 { margin-bottom: 10px; color: #3498db; }
        .file-path { color: #2c3e50; margin-bottom: 10px; }
        .file-preview { background-color: #f5f5f5; padding: 15px; border-radius: 4px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 14px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #eee; }
        .tab-btn { padding: 12px 24px; background: none; border: none; font-size: 16px; cursor: pointer; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab-btn:hover { color: #3498db; }
        .tab-btn.active { color: #3498db; border-bottom-color: #3498db; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .article-list-item { padding: 15px; margin: 10px 0; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.3s; border-left: 4px solid #3498db; }
        .article-list-item:hover { background: #e9ecef; transform: translateX(5px); }
        .article-list-item.selected { background: #d4edda; border-left-color: #28a745; }
        .article-list-item.hidden { border-left-color: #e74c3c; }
        .article-list-item-title { font-weight: bold; color: #2c3e50; margin-bottom: 5px; }
        .article-list-item-meta { font-size: 13px; color: #666; }
        .delete-btn { background-color: #dc3545; color: white; }
        .delete-btn:hover { background-color: #c82333; }
    </style>
</head>
<body>
    
    <div class="container">
        <h1>ğŸ“ æ–‡ç« ç®¡ç†</h1>
        
        <!-- é€‰é¡¹å?-->
        <div class="tabs" id="tabs" style="display: none;">
            <button class="tab-btn active" data-tab="add">â?æ·»åŠ æ–‡ç« </button>
            <button class="tab-btn" data-tab="delete">ğŸ—‘ï¸?åˆ é™¤æ–‡ç« </button>
        </div>
        
        <!-- ç™»å½•éªŒè¯åŒºåŸŸ -->
        <div class="auth-section" id="auth-section">
            <div class="auth-card">
                <h2>ğŸ” èº«ä»½éªŒè¯</h2>
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å?*</label>
                    <input type="text" class="form-input" id="auth-username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç  *</label>
                    <input type="password" class="form-input" id="auth-password" placeholder="è¯·è¾“å…¥å¯†ç ?>
                </div>
                <button type="button" class="btn btn-primary" id="login-btn" style="width: 100%;">ç™»å½•</button>
            </div>
        </div>
        
        <!-- æ–‡ç« è¡¨å•åŒºåŸŸ -->
        <div class="article-form-section" id="article-form-section" style="display: none;">
        <!-- æ·»åŠ æ–‡ç« é€‰é¡¹å?-->
        <div class="tab-content active" id="tab-add">
            <div class="draft-selector" id="draft-selector">
                <h3>ğŸ“ é€‰æ‹©è‰ç¨¿ç»§ç»­ç¼–è¾‘</h3>
                <div id="draft-list"></div>
                <button type="button" class="btn btn-secondary" id="new-article-btn" style="margin-top: 10px;">æ–°å»ºæ–‡ç« </button>
            </div>
            
            <form id="article-form">
            <div class="form-group">
                <label class="form-label">æ–‡ç« æ ‡é¢˜ *</label>
                <input type="text" class="form-input" id="article-title" placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢? required>
                <p class="form-hint">æ ‡é¢˜é•¿åº¦å»ºè®® 5-50 å­—ç¬¦</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">æ ‡ç­¾ *</label>
                <select class="form-select" id="article-tag" required>
                    <option value="">é€‰æ‹©æ ‡ç­¾</option>
                </select>
                <p class="form-hint">é€‰æ‹©ç°æœ‰æ ‡ç­¾ï¼Œæ ‡ç­¾ç±»å‹å°†åœ¨é€‰æ‹©åæ˜¾ç¤?/p>
                <div id="tag-type-indicator" style="margin-top: 8px; display: none;"></div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ä½œè€?*</label>
                <input type="text" class="form-input" id="article-author" placeholder="è¯·è¾“å…¥ä½œè€…åç§? required>
            </div>
            
            <div class="form-group">
                <label class="form-label">æ–‡ç« ç±»å‹ *</label>
                <div class="checkbox-group">
                    <input type="checkbox" id="article-hidden">
                    <label for="article-hidden">éšè—æ–‡ç« </label>
                </div>
                <p class="form-hint">å‹¾é€‰åï¼Œè¯¥æ–‡ç« å°†ä¸ä¼šåœ¨æ–‡ç« åˆ—è¡¨ä¸­æ˜¾ç¤ºï¼Œéœ€è¦é€šè¿‡ç½‘å€ç›´æ¥è®¿é—®</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">å‘å¸ƒæ—¶é—´ *</label>
                <input type="datetime-local" class="form-input" id="article-time" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">æ–‡ç« å†…å®¹ *</label>
                <textarea class="form-textarea" id="article-content" placeholder="è¯·è¾“å…¥æ–‡ç« å†…å®¹ï¼ˆæ”¯æŒMarkdownæ ¼å¼ï¼? required></textarea>
                <p class="form-hint">æ”¯æŒMarkdownæ ¼å¼ï¼Œæ®µè½ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”</p>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="save-draft-btn">ğŸ’¾ ä¿å­˜è‰ç¨¿</button>
                <button type="button" class="btn btn-secondary" id="preview-btn">é¢„è§ˆ</button>
                <button type="submit" class="btn btn-primary" id="submit-btn">å‘å¸ƒæ–‡ç« </button>
            </div>
        </form>
        
        <div class="file-info" id="file-info">
            <h3>âœ?æ–‡ç« å·²åˆ›å»?/h3>
            <p class="file-path" id="file-path"></p>
            <div class="file-preview" id="file-preview"></div>
        </div>
        </div>
        
        <!-- åˆ é™¤æ–‡ç« é€‰é¡¹å?-->
        <div class="tab-content" id="tab-delete">
            <div class="form-group">
                <label class="form-label">é€‰æ‹©è¦åˆ é™¤çš„æ–‡ç« </label>
                <div id="articles-list"></div>
                <p class="form-hint">ç‚¹å‡»é€‰æ‹©è¦åˆ é™¤çš„æ–‡ç« ï¼Œçº¢è‰²è¾¹æ¡†è¡¨ç¤ºéšè—æ–‡ç«?/p>
            </div>
            
            <div class="form-group" id="delete-preview" style="display: none;">
                <label class="form-label">æ–‡ç« é¢„è§ˆ</label>
                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #e74c3c;">
                    <h3 id="preview-title"></h3>
                    <p id="preview-meta"></p>
                    <p id="preview-summary" style="margin-top: 10px; color: #666;"></p>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn delete-btn" id="delete-article-btn">ğŸ—‘ï¸?åˆ é™¤é€‰ä¸­çš„æ–‡ç«?/button>
            </div>
            
            <div class="success-info" id="delete-success-info" style="background-color: #f8d7da; border-left-color: #dc3545; display: none;">
                <h3 style="color: #dc3545; margin-bottom: 10px;">âœ?æ–‡ç« å·²åˆ é™?/h3>
                <p id="delete-success-message" style="color: #721c24;"></p>
            </div>
        </div>
        </div>
    </div>

    <script>
        let allTags = [];
        let authToken = null;
        let currentDraft = null;
        let allArticles = [];
        let selectedArticleId = null;
        
        async function loadTags() {
            try {
                const response = await fetch('æ ‡ç­¾/metadata.json');
                if (response.ok) {
                    const data = await response.json();
                    allTags = data.tags || [];
                    updateTagSelect();
                }
            } catch (error) {
                console.error('åŠ è½½æ ‡ç­¾å¤±è´¥:', error);
            }
        }
        
        function updateTagSelect() {
            const select = document.getElementById('article-tag');
            select.innerHTML = '<option value="">é€‰æ‹©æ ‡ç­¾</option>';
            allTags.forEach(tag => {
                const option = document.createElement('option');
                option.value = tag.id;
                option.textContent = tag.name;
                option.dataset.hidden = tag.hidden;
                select.appendChild(option);
            });
        }
        
        function showTagTypeIndicator() {
            const select = document.getElementById('article-tag');
            const selectedOption = select.options[select.selectedIndex];
            const indicator = document.getElementById('tag-type-indicator');
            
            if (selectedOption && selectedOption.value) {
                const isHidden = selectedOption.dataset.hidden === 'true';
                indicator.style.display = 'block';
                indicator.className = 'tag-type-indicator ' + (isHidden ? 'tag-type-hidden' : 'tag-type-visible');
                indicator.textContent = isHidden ? 'ğŸ”’ éšè—æ ‡ç­¾' : 'ğŸ‘ï¸?æ˜¾ç¤ºæ ‡ç­¾';
            } else {
                indicator.style.display = 'none';
            }
        }
        
        function setDefaultTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('article-time').value = `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        async function loadDrafts() {
            try {
                const headers = {};
                if (authToken) {
                    headers['Authorization'] = authToken;
                }
                
                const response = await fetch('/api/get-drafts', {
                    headers: headers
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.drafts && result.drafts.length > 0) {
                        showDraftSelector(result.drafts);
                    } else {
                        document.getElementById('article-form').style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è‰ç¨¿å¤±è´¥:', error);
                document.getElementById('article-form').style.display = 'block';
            }
        }
        
        function showDraftSelector(drafts) {
            const selector = document.getElementById('draft-selector');
            const list = document.getElementById('draft-list');
            selector.style.display = 'block';
            
            list.innerHTML = '';
            drafts.forEach(draft => {
                const item = document.createElement('div');
                item.className = 'draft-item';
                item.innerHTML = `<strong>${draft.title || 'æ— æ ‡é¢?}</strong><br><small>${draft.saveTime}</small>`;
                item.onclick = () => loadDraft(draft);
                list.appendChild(item);
            });
        }
        
        function loadDraft(draft) {
            currentDraft = draft.id;
            document.getElementById('article-title').value = draft.title || '';
            document.getElementById('article-tag').value = draft.tagId || '';
            showTagTypeIndicator();
            document.getElementById('article-author').value = draft.author || '';
            document.getElementById('article-time').value = draft.publishTime || '';
            document.getElementById('article-content').value = draft.content || '';
            document.getElementById('article-hidden').checked = draft.hidden || false;
            
            // é€‰ä¸­æ•ˆæœ
            document.querySelectorAll('.draft-item').forEach(item => item.classList.remove('selected'));
            event.target.closest('.draft-item').classList.add('selected');
            
            document.getElementById('article-form').style.display = 'block';
        }
        
        document.getElementById('new-article-btn').addEventListener('click', function() {
            currentDraft = null;
            document.getElementById('draft-selector').style.display = 'none';
            document.getElementById('article-form').reset();
            setDefaultTime();
            showTagTypeIndicator();
            document.getElementById('article-form').style.display = 'block';
        });
        
        // ç™»å½•éªŒè¯
        document.getElementById('login-btn').addEventListener('click', async function() {
            const username = document.getElementById('auth-username').value.trim();
            const password = document.getElementById('auth-password').value;
            
            if (!username || !password) {
                alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ?);
                return;
            }
            
            try {
                const response = await fetch('/api/verify-user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    authToken = 'Basic ' + btoa(username + ':' + password);
                    document.getElementById('auth-section').style.display = 'none';
                    document.getElementById('article-form-section').style.display = 'block';
                    document.getElementById('tabs').style.display = 'flex';
                    loadTags();
                    setDefaultTime();
                    loadDrafts();
                    loadAllArticles();
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ?);
                console.error('éªŒè¯å¤±è´¥:', error);
            }
        });
        
        document.getElementById('article-tag').addEventListener('change', showTagTypeIndicator);
        
        document.getElementById('save-draft-btn').addEventListener('click', async function() {
            const title = document.getElementById('article-title').value.trim();
            const tagId = document.getElementById('article-tag').value;
            const author = document.getElementById('article-author').value.trim();
            const time = document.getElementById('article-time').value;
            const content = document.getElementById('article-content').value.trim();
            const hidden = document.getElementById('article-hidden').checked;
            
            if (!title) {
                alert('è¯·è¾“å…¥æ–‡ç« æ ‡é¢?);
                return;
            }
            
            const draftData = {
                id: currentDraft,
                title: title,
                tagId: tagId,
                tagName: allTags.find(t => t.id === tagId)?.name || '',
                author: author,
                publishTime: time,
                content: content,
                hidden: hidden
            };
            
            try {
                const headers = { 'Content-Type': 'application/json' };
                if (authToken) {
                    headers['Authorization'] = authToken;
                }
                
                const response = await fetch('/api/save-draft', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(draftData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('è‰ç¨¿ä¿å­˜æˆåŠŸï¼?);
                    currentDraft = result.draftId;
                } else {
                    alert('ä¿å­˜å¤±è´¥ï¼? + result.message);
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ?);
                console.error('ä¿å­˜è‰ç¨¿å¤±è´¥:', error);
            }
        });
        
        document.getElementById('submit-btn').addEventListener('click', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('article-title').value.trim();
            const tagId = document.getElementById('article-tag').value;
            const author = document.getElementById('article-author').value.trim();
            const time = document.getElementById('article-time').value;
            const content = document.getElementById('article-content').value.trim();
            const hidden = document.getElementById('article-hidden').checked;
            
            if (!title) {
                alert('è¯·è¾“å…¥æ–‡ç« æ ‡é¢?);
                return;
            }
            if (!tagId) {
                alert('è¯·é€‰æ‹©æ ‡ç­¾');
                return;
            }
            if (!author) {
                alert('è¯·è¾“å…¥ä½œè€…åç§?);
                return;
            }
            if (!time) {
                alert('è¯·é€‰æ‹©å‘å¸ƒæ—¶é—´');
                return;
            }
            if (!content) {
                alert('è¯·è¾“å…¥æ–‡ç« å†…å®?);
                return;
            }
            
            const articleData = {
                title: title,
                tagId: tagId,
                tagName: allTags.find(t => t.id === tagId)?.name || '',
                author: author,
                publishTime: time,
                content: content,
                hidden: hidden,
                draftId: currentDraft
            };
            
            try {
                const headers = { 'Content-Type': 'application/json' };
                if (authToken) {
                    headers['Authorization'] = authToken;
                }
                
                const response = await fetch('/api/save-article', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(articleData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('file-info').style.display = 'block';
                    document.getElementById('file-path').textContent = result.filePath;
                    document.getElementById('file-preview').textContent = `æ ‡é¢˜: ${title}\nä½œè€? ${author}\nå‘å¸ƒæ—¶é—´: ${time}\næ ‡ç­¾: ${articleData.tagName}`;
                    alert('æ–‡ç« å‘å¸ƒæˆåŠŸï¼?);
                    document.getElementById('article-form').reset();
                    document.getElementById('draft-selector').style.display = 'none';
                    currentDraft = null;
                    setDefaultTime();
                    loadDrafts();
                } else {
                    alert('å‘å¸ƒå¤±è´¥ï¼? + result.message);
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ?);
                console.error('ä¿å­˜æ–‡ç« å¤±è´¥:', error);
            }
        });
        
        document.getElementById('preview-btn').addEventListener('click', function() {
            const content = document.getElementById('article-content').value;
            const title = document.getElementById('article-title').value;
            alert('é¢„è§ˆåŠŸèƒ½å¼€å‘ä¸­...\n\næ ‡é¢˜: ' + (title || 'æœªè®¾ç½?) + '\nå†…å®¹é•¿åº¦: ' + content.length + ' å­—ç¬¦');
        });
        
        window.addEventListener('DOMContentLoaded', function() {
            loadTags();
            setDefaultTime();
            
            // é€‰é¡¹å¡åˆ‡æ?            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('tab-' + this.dataset.tab).classList.add('active');
                    
                    if (this.dataset.tab === 'delete') {
                        loadAllArticles();
                    }
                });
            });
        });
        
        // åŠ è½½æ‰€æœ‰æ–‡ç«?        async function loadAllArticles() {
            try {
                allArticles = [];
                const response = await fetch('æ ‡ç­¾/metadata.json');
                if (response.ok) {
                    const data = await response.json();
                    allTags = data.tags || [];
                    
                    // éå†æ‰€æœ‰æ ‡ç­¾è·å–æ–‡ç«?                    for (const tag of allTags) {
                        try {
                            const tagResponse = await fetch(`æ ‡ç­¾/${tag.folder}/metadata.json`);
                            if (tagResponse.ok) {
                                const tagData = await tagResponse.json();
                                if (tagData.articles) {
                                    tagData.articles.forEach(article => {
                                        allArticles.push({
                                            ...article,
                                            tagId: tag.id,
                                            tagName: tag.name,
                                            tagFolder: tag.folder
                                        });
                                    });
                                }
                            }
                        } catch (e) {
                            console.error('åŠ è½½æ ‡ç­¾æ–‡ç« å¤±è´¥:', e);
                        }
                    }
                    
                    renderArticleList();
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);
            }
        }
        
        // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
        function renderArticleList() {
            const container = document.getElementById('articles-list');
            container.innerHTML = '';
            
            if (allArticles.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d;">æš‚æ— æ–‡ç« </p>';
                return;
            }
            
            allArticles.forEach(article => {
                const item = document.createElement('div');
                item.className = 'article-list-item' + (article.hidden ? ' hidden' : '');
                item.dataset.id = article.id;
                item.innerHTML = `
                    <div class="article-list-item-title">${article.title}</div>
                    <div class="article-list-item-meta">
                        <span>ğŸ·ï¸?${article.tagName}</span>
                        <span>ğŸ‘¤ ${article.author}</span>
                        <span>ğŸ“… ${article.createTime}</span>
                        ${article.hidden ? '<span>ğŸ”’ éšè—</span>' : ''}
                    </div>
                `;
                item.onclick = () => selectArticle(article);
                container.appendChild(item);
            });
        }
        
        // é€‰æ‹©æ–‡ç« 
        function selectArticle(article) {
            selectedArticleId = article.id;
            
            document.querySelectorAll('.article-list-item').forEach(item => {
                item.classList.remove('selected');
                if (item.dataset.id === article.id) {
                    item.classList.add('selected');
                }
            });
            
            // æ˜¾ç¤ºé¢„è§ˆ
            document.getElementById('delete-preview').style.display = 'block';
            document.getElementById('preview-title').textContent = article.title;
            document.getElementById('preview-meta').textContent = `æ ‡ç­¾: ${article.tagName} | ä½œè€? ${article.author} | æ—¶é—´: ${article.createTime}`;
            document.getElementById('preview-summary').textContent = article.hidden ? 'è¿™æ˜¯éšè—æ–‡ç« ï¼Œéœ€è¦é€šè¿‡ç½‘å€è®¿é—®' : 'è¿™æ˜¯æ˜¾ç¤ºæ–‡ç« ';
        }
        
        // åˆ é™¤æ–‡ç« 
        document.getElementById('delete-article-btn').addEventListener('click', async function() {
            if (!selectedArticleId) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ–‡ç« ');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼?)) {
                return;
            }
            
            try {
                const headers = { 'Content-Type': 'application/json' };
                if (authToken) {
                    headers['Authorization'] = authToken;
                }
                
                const response = await fetch('/api/delete-article', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({ articleId: selectedArticleId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('delete-success-info').style.display = 'block';
                    document.getElementById('delete-success-message').textContent = result.message;
                    selectedArticleId = null;
                    document.getElementById('delete-preview').style.display = 'none';
                    loadAllArticles();
                } else {
                    alert('åˆ é™¤å¤±è´¥ï¼? + result.message);
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ?);
                console.error('åˆ é™¤æ–‡ç« å¤±è´¥:', error);
            }
        });
    </script>
</body>
</html>
